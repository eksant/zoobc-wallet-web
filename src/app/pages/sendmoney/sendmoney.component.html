<div class="sendmoney-container">
  <h2 class="mat-h2">{{ 'Send Money' | translate }}</h2>
  <mat-card>
    <form [formGroup]="formSend" (submit)="onOpenDialogDetailSendMoney()">
      <label>{{ 'From' | translate }}</label>
      <div class="from-account">
        <div class="name">{{ account.name }}</div>
        <div class="balance">100 ZBC</div>
      </div>

      <label>{{ 'Recepient address' | translate }}</label>
      <mat-form-field appearance="outline">
        <input
          matInput
          placeholder="{{ 'Recepient address' | translate }}..."
          aria-label="contacts"
          [matAutocomplete]="auto"
          formControlName="recipient"
        />
        <mat-error *ngIf="recipientForm.touched">
          <span *ngIf="recipientForm.hasError('required')">{{
            'Recepient is required' | translate
          }}</span>
        </mat-error>
        <mat-autocomplete #auto="matAutocomplete">
          <mat-option
            *ngFor="let contact of filteredContacts | async"
            [value]="contact.address"
          >
            <span>{{ contact.alias }}</span> |
            <small>{{ contact.address }}</small>
          </mat-option>
        </mat-autocomplete>
      </mat-form-field>

      <label>{{ 'Coin amount' | translate }}</label>
      <mat-form-field appearance="outline">
        <input
          matInput
          type="number"
          formControlName="amount"
          placeholder="{{ 'Coin Amount' | translate }}"
        />
        <mat-error *ngIf="amountForm.touched">
          <span *ngIf="amountForm.hasError('required')">{{
            'Amount is required' | translate
          }}</span>
        </mat-error>
      </mat-form-field>

      <label>{{ 'Fee' | translate }}</label>
      <mat-form-field appearance="outline">
        <input
          matInput
          type="number"
          formControlName="fee"
          placeholder="{{ 'Fee' | translate }}"
        />
        <mat-error *ngIf="feeForm.touched">
          <span *ngIf="feeForm.hasError('required')">{{
            'Fee is required' | translate
          }}</span>
        </mat-error>
      </mat-form-field>

      <button
        mat-flat-button
        color="primary"
        type="submit"
        [disabled]="formSend.invalid || isFormSendLoading"
      >
        <span *ngIf="isFormSendLoading">
          <i class="fas fa-circle-notch fa-spin"></i>&nbsp;
        </span>
        <span>{{ 'Send' | translate }}</span>
      </button>
    </form>
  </mat-card>
</div>

<ng-template #popupDetailSendMoney>
  <mat-card-title>Confirm Send Money</mat-card-title>
  <mat-card class="popup">
    <mat-card-content>
      <div>
        <p>Transaction Details</p>
        <div class="divTable">
          <div class="divTableBody">
            <div class="divTableRow">
              <div class="divTableCell-1">From</div>
              <div class="divTableCell">{{ address }}</div>
            </div>
            <div class="divTableRow">
              <div class="divTableCell-1">Recepient</div>
              <div class="divTableCell">{{ recipientForm.value }}</div>
            </div>
            <div class="divTableRow">
              <div class="divTableCell-1">Total</div>
              <div class="divTableCell">
                {{ amountForm.value + feeForm.value }} ({{
                  (amountForm.value + feeForm.value) *
                    (currencyRate.value | number: '0.1-2')
                }}
                {{ currencyRate.name }})
              </div>
            </div>
          </div>
        </div>
      </div>
    </mat-card-content>
  </mat-card>
  <div mat-dialog-actions align="end">
    <button mat-raised-button color="warn" (click)="closeDialog()">
      Cancel
    </button>
    <button mat-raised-button color="primary" (click)="onSendMoney()">
      Confirm
    </button>
  </div>
</ng-template>

<ng-template #pinDialog>
  <h3 class="mat-h3" id="modal-basic-title">
    <b>{{ 'Confirm Your Pin' | translate }}</b>
  </h3>
  <form [formGroup]="formConfirmPin" (submit)="onConfirmPin()">
    <field-pins
      formControlName="pin"
      (change)="onResetPinValidation()"
    ></field-pins>
    <mat-error *ngIf="isPinMatched == false">{{
      'Pin is not match' | translate
    }}</mat-error>
    <div class="text-right">
      <button mat-flat-button color="primary" type="button" (click)="onBack()">
        {{ 'Back' | translate }}
      </button>
      <button
        mat-flat-button
        color="primary"
        type="submit"
        [disabled]="formConfirmPin.invalid"
      >
        {{ 'Confirm Pin' | translate }}
      </button>
    </div>
  </form>
</ng-template>
